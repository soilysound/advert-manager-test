async function checkConsent(rootElement, callback) {
    if (rootElement === null) {
        return;
    }

    if (!rootElement.dataset.consent || rootElement.dataset.consent.toString() !== 'true') {
        const observer = new MutationObserver(function (mutationsList, observer) {
            for (const mutation of mutationsList) {
                if (
                    mutation.type !== 'attributes'
                    || mutation.attributeName !== 'data-consent'
                    || !mutation.target.attributes.getNamedItem(mutation.attributeName).value) {
                    continue;
                }

                callback();
                observer.disconnect();
            }
        });

        observer.observe(rootElement, {attributes: true});
    } else {
        await callback();
    }
}

module.exports = checkConsent;
