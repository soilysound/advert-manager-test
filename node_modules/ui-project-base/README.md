# SDC Project Base

## Description
A set of shared assets to be used by the component based DE, Skysports UK and Sky News projects.


## Require config
By default, the require config serves files relative the domain the site is running on. This is achieved by leaving
`baseUrl` empty and specifying module paths that start with `/`:
```
requirejs.config({
  "baseUrl": "",
  "paths": {
    "site-main": "/js/site-main",
    "sdc-site-auth-manager": "/js/modules/components/sdc-site-auth-manager"
  }
});
```

This can be replicated by specifying `baseUrl` as `/` and the modules without a leading `/`:
```
requirejs.config({
  "baseUrl": "/",
  "paths": {
    "site-main": "js/site-main",
    "sdc-site-auth-manager": "js/modules/components/sdc-site-auth-manager"
  }
});
```

The advantage of the above approach is you can then override this in your app template, specifying an absolute url
that may be different to the site you are on (the mobile apps need absolute urls when the html is served via the api)
```
requirejs.config({"baseUrl": "{{site-domain}}"});
```

## UI Graphics Scripts
The `copy-ui-grapics.js` script has been added to project base to allow us to manage graphics asset files when they are needed for use in UI components. The script will look for a `/assets/ui-graphics/` directory in each component and copy the contents to the same location on our apps `/web/assets/ui-graphics/`. This allows our stylesheets to reference these assets without the need (and performance imapcts) of embedding graphics among our CSS code.

To run on build, the script needs to be referenced in both the package.json and composer.json fies.

In package.json we're using a `build-ui-graphics` script as a catch all for future ui graphics-related build tasks:

```
"scripts": {
  "ui-graphics:copy": "node node_modules/sdc-project-base/build-tools/copy-ui-graphics.js",
  "build-ui-graphics": "npm-run-all ui-graphics:*"
}
```

In composer.json, `build-ui-graphics` needs to be added to the `init-components` script since it will need to run every time we initialise our UI components on the project level.
```
"init-components": [
    "npm run-script clean-files --loglevel=error",
    "npm run-script build-css --loglevel=error",
    "npm run-script build-js --loglevel=error",
    "npm run-script build-ui-graphics --loglevel=error"
],
```

NOTE: The resulting `/web/assets/ui-graphics/` directory needs to be addded to the project's .gitignore rules.

Some things to note:
* The script assumes that all graphic assets are uniquely named, therfore it's important to prefix the filename of each one with the name of its compnent.
* The script does not optimise any images (yet), so we recommend running all assets through ImageOptim and Image Alpha to reduce their filesize as much as possible.
* The script does not fingerprint any assets, so this needs to be taken into accound when editing existing files.

## sdc-project-base-static

To generate a lightweight version of project base called `sdc-project-base-static` you can run:

```
npm run export-static
```

this command will generate a /dist folder that contains: css, fonts & hbs helpers compiled into a single js file.

In gitlab this command is ran in the deploy:static-artifactory job to push this lightweight version to jfrog (it will share the tag of project base but exist as a separate package with its own name and entity in the package registry).

To use this version of project base in an app you can install it via the package.json like this: 
```
 "sdc-project-base-static": "14.2.0",
```

Installing this will make all project-base css, fonts & hbs helpers available to your app without installing any additional dependencies.