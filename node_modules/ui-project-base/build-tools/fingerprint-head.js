var fs = require('fs');
var path = require('path');
var clc = require('cli-color');

// get utility functions
var checksum = require('./get-checksum.js');
var fingerprintTools = require('./fingerprint-tools.js');

// path consts
var ROOT = path.resolve(process.cwd());
var FINGERPRINT_FILE = ROOT + '/app/config/fingerprints.yml';
var HEAD_FILE = ROOT + '/web/js/min/site-head.js';

if (!fs.existsSync(HEAD_FILE)) {
    console.info(clc.yellow("Couldn't find file. Has it already been fingerprinted? File: site-head.js"));
    return;
}

// Fingerprint head.js
var headFingerprint = checksum(fs.readFileSync(HEAD_FILE, 'utf8'));
var newFileName = 'site-head-' + headFingerprint;
var newFilepath = HEAD_FILE.replace('site-head', newFileName);
var newWebPath = '/js/min/' + newFileName + '.js';

fs.renameSync(HEAD_FILE, newFilepath);

fingerprintTools.write('site-head.js', newWebPath);
