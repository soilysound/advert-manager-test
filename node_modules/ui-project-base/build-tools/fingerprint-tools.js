var yaml = require('node-yaml');
var path = require('path');
var ROOT = path.resolve(process.cwd());
var relativeFingerprintsFile = process.env.npm_package_config_fingerprints_path || '/app/config/fingerprints.yml';
var FINGERPRINT_FILE = ROOT + relativeFingerprintsFile;

module.exports = {

    write: function(key, value){
        // Open yaml file
        var yamlConfig = yaml.readSync(FINGERPRINT_FILE);

        // Update yaml file with key value
        yamlConfig.parameters['sdc.fingerprints'][this.sanitiseKey(key)] = value;

        // write new config
        return yaml.writeSync(FINGERPRINT_FILE, yamlConfig);
    },

    writeMultiple: function(config) {
        // Open yaml file
        var yamlConfig = yaml.readSync(FINGERPRINT_FILE);

        for (var key in config) {
            if (config.hasOwnProperty(key)) {
                // Update yaml file with key value
                yamlConfig.parameters['sdc.fingerprints'][this.sanitiseKey(key)] = config[key];
            }
        }

        // write new config
        return yaml.writeSync(FINGERPRINT_FILE, yamlConfig);
    },

    sanitiseKey: function(value) {
        return value.replace('.', '-');
    }
};
