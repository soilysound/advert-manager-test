//// CHECK CONSENT
(function(){
    window.sdc = window.sdc || {};
    window.sdc.checkConsent = function(rootElement, callback) {
        if (rootElement === null) {
            return;
        }

        if (!rootElement.dataset.consent || rootElement.dataset.consent.toString() !== 'true') {
            var observer = new MutationObserver(function (mutationsList, observer) {
                for (var mutation in mutationsList) {
                    mutation = mutationsList[mutation];
                    if (
                        mutation.type !== 'attributes'
                        || mutation.attributeName !== 'data-consent'
                        || mutation.target.dataset.consent.toString() !== 'true'
                        || !mutation.target.attributes.getNamedItem(mutation.attributeName).value) {
                        continue;
                    }

                    callback();
                    observer.disconnect();
                }
            });

            observer.observe(rootElement, {attributes: true});
        } else {
            callback();
        }
    };

    window.sdc.executeConsentByElement = function(element) {
        const vendorMapping = window.sdc.consentIdMapping || {};
        const vendorName = element.dataset.vendorName;

        if (!document.cookie) {
            return;
        }

        const consentsCookie = document.cookie
            .split('; ')
            .find(function (row) { return row.startsWith('consents=') });

        if (!consentsCookie) {
            return;
        }

        const consentsValue = consentsCookie.split('=')[1];

        if (!vendorMapping) {
            return;
        }

        const vendor = vendorMapping.filter(function(vendor) {
            return vendor.vendorName === vendorName;
        })[0];

        if (consentsValue.includes(':' + vendor.gdpId + ':') && vendor.active) {
            element.dataset.consent = 'true';
            return;
        }

        // additional check for single click consent
        if (document.querySelectorAll('[data-vendor-name="' + vendorName + '"][data-consent="true"]').length) {
          element.dataset.consent = 'true';
          return;
        }

        element.dataset.consent = 'false';
    }
}());